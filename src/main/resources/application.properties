# === CONFIGURATION UNIFIÉE DIRAVENIR ===
# Un seul fichier pour tous les environnements !

# === PROFIL ACTIF ===
spring.profiles.active=dev
spring.main.allow-bean-definition-overriding=true

# === BASE DE DONNÉES MYSQL ===
spring.datasource.url=jdbc:mysql://localhost:3306/diravenir?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true&createDatabaseIfNotExist=true
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# === JPA/HIBERNATE ===
# Mode UPDATE pour le développement, VALIDATE pour la production
# IMPORTANT: Utiliser 'validate' pour éviter la suppression des données
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=${HIBERNATE_SHOW_SQL:true}
spring.jpa.properties.hibernate.format_sql=${HIBERNATE_FORMAT_SQL:true}

# === PERFORMANCE JPA ===
spring.jpa.open-in-view=false

# === FLYWAY ===
# REMOVED - Using Hibernate-only approach

# === SERVEUR ===
server.port=8084

# === CORS ===
# Configuration CORS simplifiée
spring.web.cors.allowed-origins=${CORS_ORIGINS:http://localhost:3000,http://localhost:5173,http://localhost:3005}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true

# === LOGGING ===
logging.level.com.diravenir=${LOG_LEVEL:DEBUG}
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=${HIBERNATE_SHOW_SQL:DEBUG}
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=${HIBERNATE_FORMAT_SQL:DEBUG}

# === PERFORMANCE ===
# Optimisations pour les performances
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# === ADMIN CONFIGURATION ===
# Configuration de l'admin principal (à gérer manuellement)
app.admin.email=${ADMIN_EMAIL:admin@diravenir.com}
app.admin.password=${ADMIN_PASSWORD:admin123}
app.admin.nom=${ADMIN_NOM:Admin}
app.admin.prenom=${ADMIN_PRENOM:System}

# === JWT CONFIGURATION ===
# Configuration JWT mise à jour pour la sécurité
# Clé secrète Base64 valide (256 bits) - Version corrigée
application.security.jwt.secret-key=NDA0RTYzNTI2NjU1NkE1ODZFMzI3MjM1NzUzODc4MkY0MTNGNDQyODQ3MkI0QjYyNTA2NDUzNjc1NjZCNTk3MA==
application.security.jwt.expiration=86400000
application.security.jwt.refresh-token.expiration=604800000

# === SPRING SECURITY ===
# Configuration de sécurité Spring - SIMPLIFIÉE

# === SESSION CONFIGURATION ===
# Configuration des sessions simplifiée
spring.session.timeout=3600
spring.session.cookie.secure=false
spring.session.cookie.http-only=true
spring.session.cookie.same-site=lax
spring.session.cookie.max-age=3600

# === COOKIE SECURITY ===
# Configuration des cookies sécurisés - CORRIGÉE pour le développement
app.cookie.secure=false
app.cookie.http-only=true
app.cookie.same-site=Lax
app.cookie.domain=

# === EMAIL CONFIGURATION UNIFIÉE ===
# Configuration SMTP Gmail pour l'envoi d'emails (OTP, vérification, etc.)
# Mode MOCK désactivé pour permettre l'envoi d'emails réels
app.email.mock=false

# Configuration SMTP Gmail (désactivée en mode mock)
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=imanecompte024@gmail.com
spring.mail.password=eeor guik iftz nico
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
spring.mail.properties.mail.smtp.starttls.required=true
spring.mail.properties.mail.smtp.connectiontimeout=10000
spring.mail.properties.mail.smtp.timeout=10000
spring.mail.properties.mail.smtp.writetimeout=10000
spring.mail.properties.mail.smtp.ssl.trust=smtp.gmail.com
spring.mail.properties.mail.smtp.ssl.protocols=TLSv1.2

# === EMAIL VERIFICATION ===
# Configuration de la vérification email
app.email.verification.expiration=${EMAIL_VERIFICATION_EXPIRATION:168}
app.email.verification.cleanup.interval=21600000

# === PASSWORD RESET ===
# Configuration de la réinitialisation de mot de passe
app.password.reset.expiration=${PASSWORD_RESET_EXPIRATION:1}

# === OTP CONFIGURATION ===
# Configuration OTP pour l'envoi de codes de vérification
app.otp.expiry-minutes=${OTP_EXPIRY_MINUTES:10}
app.otp.max-daily-attempts=${OTP_MAX_DAILY_ATTEMPTS:5}
app.otp.length=${OTP_LENGTH:6}
app.otp.security.max-retry-attempts=${OTP_MAX_RETRY_ATTEMPTS:3}
app.otp.security.block-duration-minutes=${OTP_BLOCK_DURATION:30}
app.otp.security.require-email-verification=true

# === EMAIL TEMPLATES ===
# Configuration des templates email pour OTP
app.email.templates.otp.subject=Code de vérification Diravenir
app.email.templates.otp.from=Diravenir <imanecompte024@gmail.com>
app.email.templates.otp.reply-to=support@diravenir.com

# === NOTIFICATIONS ===
# Configuration des notifications
app.notifications.email.enabled=true
app.notifications.sms.enabled=false
app.notifications.whatsapp.enabled=false

# === RATE LIMITING ===
# Limitation du taux de requêtes
rate.limit.max=${RATE_LIMIT_MAX:60}
signup.rate.limit=${SIGNUP_RATE_LIMIT:10}

# === SESSION CLEANUP ===
# Nettoyage automatique des sessions - CORRIGÉ pour éviter la persistance
session.cleanup.interval=${SESSION_CLEANUP_INTERVAL:60000}
session.inactivity.threshold=${SESSION_INACTIVITY_THRESHOLD:5}
spring.session.cleanup.interval=60000
spring.session.cleanup.on-startup=true

# === FRONTEND URL ===
# URL du frontend pour les liens dans les emails
app.frontend.url=${FRONTEND_URL:http://localhost:5173}

# === ELASTICSEARCH ===
# Désactivation d'Elasticsearch pour éviter les avertissements
spring.data.elasticsearch.repositories.enabled=false
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchDataAutoConfiguration,org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration

# === GOOGLE OAUTH2 CONFIGURATION ===
# Configuration Google OAuth2 (valeurs par défaut pour le développement)
google.client-id=${GOOGLE_CLIENT_ID:your-google-client-id}
google.client-secret=${GOOGLE_CLIENT_SECRET:your-google-client-secret}
google.redirect-uri=${GOOGLE_REDIRECT_URI:http://localhost:8084/auth/oauth2/callback/google}

# === ENVIRONMENT ===
# Variables d'environnement
spring.config.import=optional:file:.env[.properties]
