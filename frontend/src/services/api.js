// Service API am√©lior√© avec gestion d'erreur robuste
import axios from 'axios';

// Configuration de l'API
const API_BASE_URL = process.env.REACT_APP_API_URL || 'http://localhost:8084/api';

// Instance axios avec configuration
const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000, // 10 secondes de timeout
  headers: {
    'Content-Type': 'application/json',
  },
});

// Intercepteur pour les requ√™tes
apiClient.interceptors.request.use(
  (config) => {
    // Ajouter un timestamp unique pour chaque requ√™te
    config.metadata = { startTime: new Date() };
    
    // Ajouter le token d'authentification si disponible
    const token = localStorage.getItem('token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    
    // Log de la requ√™te
    console.log(`üöÄ API Request: ${config.method?.toUpperCase()} ${config.url}`);
    
    return config;
  },
  (error) => {
    console.error('‚ùå Erreur de configuration de requ√™te:', error);
    return Promise.reject(error);
  }
);

// Intercepteur pour les r√©ponses
apiClient.interceptors.response.use(
  (response) => {
    const duration = new Date() - response.config.metadata.startTime;
    console.log(`‚úÖ API Response: ${response.status} (${duration}ms) - ${response.config.url}`);
    return response;
  },
  (error) => {
    const duration = error.config?.metadata?.startTime 
      ? new Date() - error.config.metadata.startTime 
      : 'N/A';
    
    if (error.response) {
      // Erreur de r√©ponse du serveur
      console.error(`‚ùå API Error: ${error.response.status} (${duration}ms) - ${error.config?.url}`);
      console.error('D√©tails:', error.response.data);
      
      // G√©rer les erreurs d'authentification
      if (error.response.status === 401) {
        console.warn('üîê Token expir√© ou invalide, redirection vers login');
        localStorage.removeItem('token');
        localStorage.removeItem('user');
        window.location.href = '/login';
      }
    } else if (error.request) {
      // Erreur de requ√™te (pas de r√©ponse)
      console.error(`‚ùå API Connection Error: ${error.code || 'NETWORK_ERROR'} (${duration}ms) - ${error.config?.url}`);
      console.error('Le serveur backend n\'est pas accessible. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
    } else {
      // Erreur de configuration
      console.error('‚ùå API Configuration Error:', error.message);
    }
    
    return Promise.reject(error);
  }
);

// Service de programmes
export const programService = {
  // R√©cup√©rer tous les programmes
  async getAll() {
    try {
      const response = await apiClient.get('/programs');
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, program: "Computer Science", universities: "Demo University" },
          { id: 2, program: "Business Administration", universities: "Demo University" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // R√©cup√©rer un programme par ID
  async getById(id) {
    try {
      const response = await apiClient.get(`/programs/${id}`);
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs/{id} - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return {
          id: id,
          program: "Computer Science",
          universities: "Demo University",
          description: "Programme de d√©monstration"
        };
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // R√©cup√©rer les d√©tails complets d'un programme
  async getDetailById(id) {
    try {
      const response = await apiClient.get(`/programs/detail/${id}`);
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs/detail - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return {
          id: id,
          program: "Computer Science",
          universities: "Demo University",
          description: "Programme de d√©monstration"
        };
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },
  
  // ===== NOUVELLES M√âTHODES POUR PROGRAMMES SIMILAIRES =====
  
  // R√©cup√©rer les programmes similaires (m√™me nom) dans d'autres universit√©s
  async getSimilarPrograms(id) {
    try {
      const response = await apiClient.get(`/programs/${id}/similar`);
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs/similar - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, program: "Computer Science", universities: "Demo University" },
          { id: 2, program: "Software Engineering", universities: "Demo University" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },
  
  // R√©cup√©rer les programmes dans la m√™me cat√©gorie
  async getProgramsByCategory(id) {
    try {
      const response = await apiClient.get(`/programs/${id}/category`);
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs/category - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, program: "Computer Science", universities: "Demo University" },
          { id: 2, program: "Information Technology", universities: "Demo University" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },
  
  // R√©cup√©rer les programmes similaires avec fallback intelligent
  async getSimilarProgramsIntelligent(id) {
    try {
      const response = await apiClient.get(`/programs/${id}/similar-intelligent`);
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs/similar-intelligent - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, program: "Computer Science", universities: "Demo University" },
          { id: 2, program: "Software Engineering", universities: "Demo University" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Rechercher des programmes
  async search(query) {
    try {
      const response = await apiClient.get('/programs/search', {
        params: { q: query }
      });
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs/search - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, program: "Computer Science", universities: "Demo University" },
          { id: 2, program: "Business Administration", universities: "Demo University" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  }
};

// Service de sant√© du backend
export const healthService = {
  // V√©rifier la sant√© du backend
  async checkHealth() {
    try {
      const response = await apiClient.get('/health');
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        return {
          status: 'DOWN',
          message: 'Backend non accessible',
          error: 'ERR_CONNECTION_REFUSED'
        };
      }
      throw error;
    }
  }
};

// Service de destinations
export const destinationService = {
  // R√©cup√©rer toutes les destinations
  async getAll() {
    try {
      const response = await apiClient.get('/destinations');
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /destinations - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, nom: "Chine", description: "Pays d'Asie avec d'excellentes universit√©s", image: "üá®üá≥" },
          { id: 2, nom: "Chypre", description: "√éle m√©diterran√©enne avec des programmes internationaux", image: "üá®üáæ" },
          { id: 3, nom: "Turquie", description: "Pays eurasien avec des universit√©s modernes", image: "üáπüá∑" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  }
};

// Service de fili√®res/programmes (alias pour programService)
export const filiereService = {
  // R√©cup√©rer tous les programmes
  async getAll() {
    try {
      const response = await apiClient.get('/programs');
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /programs - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, nom: "Computer Science", description: "Programme en informatique" },
          { id: 2, nom: "Business Administration", description: "Programme en administration des affaires" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  }
};

// Service de t√©moignages (placeholder - √† impl√©menter selon vos besoins)
export const temoignageService = {
  async getAll() {
    // Pour l'instant, retourner des donn√©es factices
    return [
      {
        id: 1,
        nom: "Marie Dupont",
        programme: "Computer Science",
        universite: "Hefei University",
        message: "Excellente exp√©rience d'√©tudes en Chine !"
      },
      {
        id: 2,
        nom: "Jean Martin",
        programme: "Business Administration",
        universite: "Cyprus International University",
        message: "Formation de qualit√© dans un environnement international."
      }
    ];
  }
};

// Service de partenaires (placeholder - √† impl√©menter selon vos besoins)
export const partenaireService = {
  async getAll() {
    // Pour l'instant, retourner des donn√©es factices
    return [
      {
        id: 1,
        nom: "Hefei University",
        pays: "Chine",
        description: "Universit√© reconnue en Chine avec un excellent niveau d'enseignement."
      },
      {
        id: 2,
        nom: "Cyprus International University",
        pays: "Chypre",
        description: "Universit√© internationale offrant des programmes de qualit√©."
      }
    ];
  }
};

// Service de gestion des utilisateurs
export const utilisateurService = {
  // R√©cup√©rer tous les utilisateurs
  async getAll() {
    try {
      const response = await apiClient.get('/users');
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /users - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, nom: "Utilisateur Demo", email: "demo@example.com" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // R√©cup√©rer un utilisateur par ID
  async getById(id) {
    try {
      const response = await apiClient.get(`/users/${id}`);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Cr√©er un utilisateur
  async create(userData) {
    try {
      const response = await apiClient.post('/users', userData);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Mettre √† jour un utilisateur
  async update(id, userData) {
    try {
      const response = await apiClient.put(`/users/${id}`, userData);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Supprimer un utilisateur
  async delete(id) {
    try {
      const response = await apiClient.delete(`/users/${id}`);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  }
};

// Service de gestion des candidatures
export const candidatureService = {
  // R√©cup√©rer toutes les candidatures
  async getAll() {
    try {
      const response = await apiClient.get('/candidatures');
      return response.data;
    } catch (error) {
      // Gestion sp√©cifique des erreurs 401 (non autoris√©)
      if (error.response?.status === 401) {
        console.warn('‚ö†Ô∏è Acc√®s non autoris√© √† /candidatures - utilisation des donn√©es de d√©monstration');
        // Retourner des donn√©es de d√©monstration en cas d'erreur 401
        return [
          { id: 1, status: "EN_COURS", programName: "Computer Science" }
        ];
      }
      
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // R√©cup√©rer une candidature par ID
  async getById(id) {
    try {
      const response = await apiClient.get(`/candidatures/${id}`);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Cr√©er une candidature
  async create(candidatureData) {
    try {
      const response = await apiClient.post('/candidatures', candidatureData);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Mettre √† jour une candidature
  async update(id, candidatureData) {
    try {
      const response = await apiClient.put(`/candidatures/${id}`, candidatureData);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // Supprimer une candidature
  async delete(id) {
    try {
      const response = await apiClient.delete(`/candidatures/${id}`);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // R√©cup√©rer les candidatures d'un utilisateur
  async getByUserId(userId) {
    try {
      const response = await apiClient.get(`/candidatures/user/${userId}`);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  },

  // R√©cup√©rer les candidatures pour un programme
  async getByProgramId(programId) {
    try {
      const response = await apiClient.get(`/candidatures/program/${programId}`);
      return response.data;
    } catch (error) {
      if (error.code === 'ERR_NETWORK' || error.message.includes('Failed to fetch')) {
        throw new Error('Impossible de se connecter au serveur backend. V√©rifiez qu\'il est d√©marr√© sur le port 8080.');
      }
      throw error;
    }
  }
};

// Fonctions d'export pour compatibilit√© avec HomePage.jsx
export const fetchDestinations = () => destinationService.getAll();
export const fetchFilieres = () => filiereService.getAll();
export const fetchTemoignages = () => temoignageService.getAll();
export const fetchPartenaires = () => partenaireService.getAll();

// ===== STUDENT DASHBOARD SERVICES =====

// Service pour les statistiques √©tudiant
const studentStatsService = {
  // R√©cup√©rer les statistiques de l'√©tudiant
  async getStudentStats() {
    try {
      const response = await apiClient.get('/student/stats');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration stats √©tudiant:', error);
      throw error;
    }
  },

  // R√©cup√©rer les applications de l'√©tudiant
  async getStudentApplications() {
    try {
      const response = await apiClient.get('/student/applications');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration applications √©tudiant:', error);
      throw error;
    }
  },

  // R√©cup√©rer les r√©sultats de tests de l'√©tudiant
  async getStudentTestResults() {
    try {
      const response = await apiClient.get('/student/test-results');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration r√©sultats tests:', error);
      throw error;
    }
  },

  // R√©cup√©rer les donn√©es de timeline de l'√©tudiant
  async getStudentTimeline() {
    try {
      const response = await apiClient.get('/student/timeline');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration timeline √©tudiant:', error);
      throw error;
    }
  },

  // R√©cup√©rer le profil de l'√©tudiant
  async getStudentProfile() {
    try {
      const response = await apiClient.get('/student/profile');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration profil √©tudiant:', error);
      throw error;
    }
  },

  // Mettre √† jour le profil de l'√©tudiant
  async updateStudentProfile(profileData) {
    try {
      const response = await apiClient.put('/student/profile', profileData);
      return response.data;
    } catch (error) {
      console.error('Erreur mise √† jour profil √©tudiant:', error);
      throw error;
    }
  },

  // ===== DASHBOARD √âTUDIANT =====
  
  /**
   * R√©cup√©rer les statistiques du dashboard √©tudiant
   */
  async getStudentStats() {
    try {
      const response = await apiClient.get('/student/stats');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration stats √©tudiant:', error);
      throw error;
    }
  },

  /**
   * R√©cup√©rer les candidatures de l'√©tudiant
   */
  async getStudentApplications() {
    try {
      const response = await apiClient.get('/student/applications');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration candidatures:', error);
      throw error;
    }
  },

  /**
   * R√©cup√©rer les r√©sultats de tests de l'√©tudiant
   */
  async getStudentTestResults() {
    try {
      const response = await apiClient.get('/student/test-results');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration r√©sultats tests:', error);
      throw error;
    }
  },

  /**
   * R√©cup√©rer la timeline de l'√©tudiant
   */
  async getStudentTimeline() {
    try {
      const response = await apiClient.get('/student/timeline');
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration timeline:', error);
      throw error;
    }
  },

  /**
   * R√©cup√©rer les programmes sauvegard√©s de l'√©tudiant
   */
  async getPrograms(userEmail = null) {
    try {
      // Si pas d'email fourni, essayer de le r√©cup√©rer depuis le localStorage
      if (!userEmail) {
        const userInfo = JSON.parse(localStorage.getItem('user') || '{}');
        userEmail = userInfo.email;
      }
      
      if (!userEmail) {
        throw new Error('Email utilisateur requis pour r√©cup√©rer les programmes sauvegard√©s');
      }
      
      const response = await apiClient.get(`/student/programs?email=${encodeURIComponent(userEmail)}`);
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration programmes:', error);
      throw error;
    }
  },

  /**
   * R√©cup√©rer les programmes sauvegard√©s
   */
  async getSavedPrograms() {
    try {
      const userEmail = localStorage.getItem('userEmail') || 'student@diravenir.com';
      const response = await apiClient.get(`/student/saved-programs?email=${userEmail}`);
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration programmes sauvegard√©s:', error);
      throw error;
    }
  },

  /**
   * Sauvegarder un programme
   */
  async saveProgram(programId) {
    try {
      const userEmail = localStorage.getItem('userEmail') || 'student@diravenir.com';
      const response = await apiClient.post('/student/save-program', {
        programId,
        userEmail
      });
      return response.data;
    } catch (error) {
      console.error('Erreur sauvegarde programme:', error);
      throw error;
    }
  },

  /**
   * Retirer un programme des sauvegard√©s
   */
  async removeSavedProgram(programId) {
    try {
      const userEmail = localStorage.getItem('userEmail') || 'student@diravenir.com';
      const response = await apiClient.delete(`/student/saved-programs/${programId}?email=${userEmail}`);
      return response.data;
    } catch (error) {
      console.error('Erreur suppression programme sauvegard√©:', error);
      throw error;
    }
  },

  /**
   * Mettre √† jour les param√®tres de l'√©tudiant
   */
  async updateStudentSettings(settingsData) {
    try {
      const userEmail = localStorage.getItem('userEmail') || 'student@diravenir.com';
      const response = await apiClient.put('/student/settings', {
        ...settingsData,
        userEmail
      });
      return response.data;
    } catch (error) {
      console.error('Erreur mise √† jour param√®tres:', error);
      throw error;
    }
  }
};

// Objet principal apiService qui combine tous les services
const apiService = {
  // Programmes
  ...programService,
  
  // Candidatures (Applications)
  ...candidatureService,
  
  // Utilisateurs
  ...utilisateurService,
  
  // Statistiques √©tudiant
  ...studentStatsService,
  
  // Services suppl√©mentaires
  ...healthService,
  ...destinationService,
  ...filiereService,
  ...temoignageService,
  ...partenaireService,
  
  // M√©thodes utilitaires
  async healthCheck() {
    try {
      const response = await apiClient.get('/health');
      return response.data;
    } catch (error) {
      console.error('Erreur health check:', error);
      throw error;
    }
  },

  // ===== NOTIFICATION SERVICES =====
  
  // Cr√©er une notification
  async createNotification(notificationData) {
    try {
      const response = await apiClient.post('/notifications', notificationData);
      return response.data;
    } catch (error) {
      console.error('Erreur cr√©ation notification:', error);
      throw error;
    }
  },

  // R√©cup√©rer les notifications de l'utilisateur
  async getUserNotifications(userId) {
    try {
      const response = await apiClient.get(`/notifications/user/${userId}`);
      return response.data;
    } catch (error) {
      console.error('Erreur r√©cup√©ration notifications:', error);
      throw error;
    }
  },

  // Marquer une notification comme lue
  async markNotificationAsRead(notificationId) {
    try {
      const response = await apiClient.put(`/notifications/${notificationId}/read`);
      return response.data;
    } catch (error) {
      console.error('Erreur marquage notification:', error);
      throw error;
    }
  },

  // Envoyer un email
  async sendEmail(emailData) {
    try {
      const response = await apiClient.post('/email/send', emailData);
      return response.data;
    } catch (error) {
      console.error('Erreur envoi email:', error);
      throw error;
    }
  },

  // ===== STUDENT PROFILE SERVICES =====
  
  // R√©cup√©rer le profil de l'√©tudiant
  async getStudentProfile() {
    try {
      const response = await apiClient.get('/student/profile');
      return {
        success: true,
        data: response.data
      };
    } catch (error) {
      console.error('Erreur r√©cup√©ration profil √©tudiant:', error);
      throw error;
    }
  },

  // Mettre √† jour le profil de l'√©tudiant
  async updateStudentProfile(profileData) {
    try {
      const response = await apiClient.put('/student/profile', profileData);
      return {
        success: true,
        data: response.data
      };
    } catch (error) {
      console.error('Erreur mise √† jour profil √©tudiant:', error);
      throw error;
    }
  },

  // ===== ADMIN APPLICATION ENDPOINTS =====
  
  // R√©cup√©rer toutes les applications pour l'admin
  getAdminApplications: async (params = {}) => {
    try {
      console.log('üìä R√©cup√©ration des applications admin...');
      const response = await apiClient.get('/admin/applications', { params });
      console.log('‚úÖ Applications admin r√©cup√©r√©es:', response.data);
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur lors de la r√©cup√©ration des applications admin:', error);
      throw error;
    }
  },

  // Mettre √† jour le statut d'une application
  updateApplicationStatus: async (applicationId, status, adminNotes = '') => {
    try {
      console.log(`üîÑ Mise √† jour du statut de l'application ${applicationId} vers ${status}...`);
      const response = await apiClient.put(`/admin/applications/${applicationId}/status`, {
        status,
        adminNotes
      });
      console.log('‚úÖ Statut mis √† jour avec succ√®s:', response.data);
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur lors de la mise √† jour du statut:', error);
      throw error;
    }
  },

  // T√©l√©charger le PDF d'une application
  downloadApplicationPDF: async (applicationId) => {
    try {
      console.log(`üìÑ T√©l√©chargement du PDF pour l'application ${applicationId}...`);
      const response = await apiClient.get(`/admin/applications/${applicationId}/pdf`, {
        responseType: 'blob'
      });
      console.log('‚úÖ PDF t√©l√©charg√© avec succ√®s');
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur lors du t√©l√©chargement du PDF:', error);
      throw error;
    }
  },

  // R√©cup√©rer les statistiques des applications
  getApplicationStatistics: async () => {
    try {
      console.log('üìà R√©cup√©ration des statistiques des applications...');
      const response = await apiClient.get('/admin/applications/statistics');
      console.log('‚úÖ Statistiques r√©cup√©r√©es:', response.data);
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur lors de la r√©cup√©ration des statistiques:', error);
      throw error;
    }
  },

  // ===== STUDENT APPLICATION ENDPOINTS =====
  
  // R√©cup√©rer les applications de l'√©tudiant
  getStudentApplications: async () => {
    try {
      console.log('üìã R√©cup√©ration des applications de l\'√©tudiant...');
      const response = await apiClient.get('/student/applications');
      console.log('‚úÖ Applications √©tudiant r√©cup√©r√©es:', response.data);
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur lors de la r√©cup√©ration des applications √©tudiant:', error);
      throw error;
    }
  },

  // R√©cup√©rer une application sp√©cifique de l'√©tudiant
  getStudentApplication: async (applicationId) => {
    try {
      console.log(`üìã R√©cup√©ration de l'application ${applicationId}...`);
      const response = await apiClient.get(`/student/applications/${applicationId}`);
      console.log('‚úÖ Application r√©cup√©r√©e:', response.data);
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur lors de la r√©cup√©ration de l\'application:', error);
      throw error;
    }
  },

  // M√©thode de connexion
  async login(credentials) {
    try {
      console.log('üîë Tentative de connexion avec:', credentials.email);
      const response = await apiClient.post('/api/auth/login', credentials);
      console.log('‚úÖ Connexion r√©ussie:', response.data);
      return response.data;
    } catch (error) {
      console.error('‚ùå Erreur de connexion:', error);
      throw error;
    }
  }
};

// Export de l'objet principal apiService
export default apiService;

// Export de l'instance axios pour utilisation directe si n√©cessaire
export { apiClient };
